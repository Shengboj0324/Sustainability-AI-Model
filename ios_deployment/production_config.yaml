# ReleAF AI - Production Configuration for iOS Deployment
# Version: 1.0.0

# API Gateway Configuration
api_gateway:
  host: "0.0.0.0"
  port: 8080
  workers: 4
  timeout: 60
  
  # CORS Configuration for iOS
  cors:
    allow_origins:
      - "https://releaf.ai"
      - "https://www.releaf.ai"
      - "https://app.releaf.ai"
      # iOS app bundle identifier
      - "capacitor://localhost"
      - "ionic://localhost"
    allow_credentials: true
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allow_headers:
      - "Content-Type"
      - "Authorization"
      - "X-API-Key"
      - "X-Request-ID"
      - "User-Agent"
    expose_headers:
      - "X-RateLimit-Limit"
      - "X-RateLimit-Remaining"
      - "Retry-After"
    max_age: 3600
  
  # Rate Limiting for iOS
  rate_limiting:
    enabled: true
    requests_per_minute: 100
    burst_size: 20
    # Premium tier for authenticated users
    premium_requests_per_minute: 500
    premium_burst_size: 100
  
  # Authentication
  authentication:
    enabled: true
    require_auth: false  # Optional for public endpoints
    api_key_header: "X-API-Key"
    jwt_secret: "${JWT_SECRET}"  # From environment
    jwt_algorithm: "HS256"
    jwt_expiration_hours: 24
  
  # Request/Response
  max_request_size_mb: 10  # For image uploads
  max_response_size_mb: 5
  compression_enabled: true
  compression_min_size_kb: 1

# Service URLs (Internal)
services:
  orchestrator:
    url: "http://orchestrator-service:8001"
    timeout: 30
    max_retries: 3
    
  llm:
    url: "http://llm-service:8002"
    timeout: 30
    max_retries: 2
    
  rag:
    url: "http://rag-service:8003"
    timeout: 20
    max_retries: 3
    
  vision:
    url: "http://vision-service:8004"
    timeout: 25
    max_retries: 2
    
  kg:
    url: "http://kg-service:8005"
    timeout: 15
    max_retries: 3
    
  org_search:
    url: "http://org-search-service:8006"
    timeout: 10
    max_retries: 3

# Database Configuration
databases:
  postgres:
    host: "${POSTGRES_HOST}"
    port: 5432
    database: "${POSTGRES_DB}"
    user: "${POSTGRES_USER}"
    password: "${POSTGRES_PASSWORD}"
    pool_size: 20
    max_overflow: 10
    pool_timeout: 30
    pool_recycle: 3600
    
  redis:
    host: "${REDIS_HOST}"
    port: 6379
    password: "${REDIS_PASSWORD}"
    db: 0
    max_connections: 50
    socket_timeout: 5
    socket_connect_timeout: 5
    
  neo4j:
    uri: "${NEO4J_URI}"
    user: "${NEO4J_USER}"
    password: "${NEO4J_PASSWORD}"
    max_connection_lifetime: 3600
    max_connection_pool_size: 50
    connection_acquisition_timeout: 60
    
  qdrant:
    host: "${QDRANT_HOST}"
    port: 6333
    api_key: "${QDRANT_API_KEY}"
    timeout: 30

# Caching Strategy
caching:
  enabled: true
  backend: "redis"
  default_ttl: 300  # 5 minutes
  
  # Per-endpoint TTL
  ttl_config:
    "/health": 10
    "/api/v1/chat": 0  # No caching for chat
    "/api/v1/vision/analyze": 3600  # 1 hour for same image
    "/api/v1/organizations/search": 600  # 10 minutes
    "/api/v1/organizations/types": 86400  # 24 hours
  
  # Cache warming
  warm_cache_on_startup: true
  warm_cache_endpoints:
    - "/api/v1/organizations/types"

# Monitoring & Logging
monitoring:
  enabled: true
  
  # Prometheus
  prometheus:
    enabled: true
    port: 9090
    path: "/metrics"
    
  # Jaeger Tracing
  jaeger:
    enabled: true
    agent_host: "jaeger-agent"
    agent_port: 6831
    sampler_type: "probabilistic"
    sampler_param: 0.1  # 10% sampling
    
  # Sentry Error Tracking
  sentry:
    enabled: true
    dsn: "${SENTRY_DSN}"
    environment: "production"
    traces_sample_rate: 0.1
    
  # Logging
  logging:
    level: "INFO"
    format: "json"
    output: "stdout"
    include_request_id: true
    include_user_agent: true
    include_ip_address: true

# Performance Optimization
performance:
  # Connection Pooling
  connection_pooling:
    enabled: true
    pool_size: 50
    max_overflow: 20
    
  # Request Batching
  request_batching:
    enabled: false  # Disable for real-time chat
    
  # Response Compression
  compression:
    enabled: true
    min_size: 1024
    level: 6
    
  # Async Processing
  async_processing:
    enabled: true
    worker_threads: 4

# Security
security:
  # SSL/TLS
  ssl_enabled: true
  ssl_cert_path: "/etc/ssl/certs/releaf.crt"
  ssl_key_path: "/etc/ssl/private/releaf.key"
  
  # Headers
  security_headers:
    X-Content-Type-Options: "nosniff"
    X-Frame-Options: "DENY"
    X-XSS-Protection: "1; mode=block"
    Strict-Transport-Security: "max-age=31536000; includeSubDomains"
    Content-Security-Policy: "default-src 'self'"
  
  # API Key Validation
  api_key_validation:
    enabled: true
    min_length: 32
    require_prefix: "releaf_"

# iOS-Specific Optimizations
ios_optimizations:
  # Image Processing
  image_processing:
    max_size_mb: 5
    auto_resize: true
    max_dimension: 1920
    compression_quality: 0.8
    supported_formats: ["JPEG", "PNG", "HEIC"]
  
  # Response Formatting
  response_formatting:
    include_markdown: true
    include_html: true
    include_plain_text: true
    optimize_for_mobile: true
  
  # Offline Support
  offline_support:
    enable_etag: true
    enable_last_modified: true
    cache_control_max_age: 300
  
  # Battery Optimization
  battery_optimization:
    reduce_polling: true
    batch_notifications: true
    adaptive_quality: true

# Feature Flags
feature_flags:
  enable_vision_recommendations: true
  enable_kg_integration: true
  enable_org_search: true
  enable_chat_history: true
  enable_user_feedback: true
  enable_analytics: true
  enable_push_notifications: false  # Not yet implemented

# Deployment
deployment:
  environment: "production"
  region: "us-west-2"
  availability_zones: ["us-west-2a", "us-west-2b", "us-west-2c"]
  auto_scaling:
    enabled: true
    min_instances: 3
    max_instances: 20
    target_cpu_percent: 70
    target_memory_percent: 80

